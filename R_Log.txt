```{r}
library(EnvStats)
library(dplyr)
library(car)
library(klaR)
library(tidyverse)
library(leaps)
library(rgbif)
library(rgeos)
library(rgdal)
library(sp)
library(sf)
library(stringr)
library(olsrr)
#log output and code
my_log <- file("my_log.txt") # File name of output log
sink(my_log, append = TRUE, type = "output") # Writing console output to log file
sink(my_log, append = TRUE, type = "message")
cat(readChar(rstudioapi::getSourceEditorContext()$path, # Writing currently opened R script to file
             file.info(rstudioapi::getSourceEditorContext()$path)$size))
```

```{r}
#read data and get rid of unwanted columns
df <- read.csv("homes_for_model.csv")

df$numPhoto <- df$numPhoto + 4
df$parcelRes <- ifelse(df$mf == 0, df$parcel, df$livingArea)
df$numDwellings <- log(df$numDwellings)

both.lose <- c( "mfYear", "mfBath", "mfBed", "minLotApt", "maxDensity", "chars",  "month", "timeAbs", "roosevelt", "zeroPhoto", "chars", "recent", "goodElem", "landValue", "minLotOne", "res", "midElem", "pr5", "lFreq", "wordLen", "pr7", "pr10", "words", "time", "pacNSA", "usNSA")

both <- df[!colnames(df) %in% both.lose]
```


```{r}
#function to check model for adequacy
model_adequacy <- function(model) {
  print(summary(model))
  print(ols_test_normality(model))
  plot(model)
  #print PRESS
  pr <- resid(model)/(1 - lm.influence(model)$hat)
  sum(pr ^ 2)
} 
```


```{r echo=FALSE}
#Create full model
fm <- lm(price ~ ., data=both)
summary(fm)
ols_test_normality(fm)
pr <- resid(fm)/(1 - lm.influence(fm)$hat)
sum(pr ^ 2)
```

```{r}
#use the all models method for OLS
models <- regsubsets(price ~ . + mf:livingArea, data = both, intercept = TRUE, nvmax = 36, really.big = TRUE)
results <- summary(models)
best <- data.frame(
  Adj.R2 = which.max(results$adjr2),
  CP = which.min(results$cp),
  BIC = which.min(results$bic)
)

coef(models, c(best$Adj.R2, best$CP, best$BIC))
```

```{r}
#OLS model and get PRESS statistic
m <- lm(price ~ livingArea + yearBuilt  + numDwellings + seasonal + pacSA + parcelRes + combined + mf + r10 + mf:livingArea, data = both)
summary(m)
ols_test_normality(m)
ols_test_correlation(m)
round(m$coefficients, 5)
pr <- resid(m)/(1 - lm.influence(m)$hat)
sum(pr ^ 2)
plot(m)
summary(m)
```
```{r}
m2 <- lm(price ~ livingArea  + combined + mf + r10 + mf:livingArea, data = both)
summary(m2)
pr <- resid(m2)/(1 - lm.influence(m2)$hat)
sum(pr ^ 2)
```

```{r}
#make weights
m.weights <- 1/lm(abs(m$residuals) ~ m$fitted.values)$fitted.values^2
#use the all models method with weights
models <- regsubsets(price ~ . + mf:livingArea, data = both, intercept = TRUE, nvmax = 36, really.big = TRUE, weights = m.weights)
results <- summary(models)
best <- data.frame(
  Adj.R2 = which.max(results$adjr2),
  CP = which.min(results$cp),
  BIC = which.min(results$bic)
)
coef(models, c(best$Adj.R2, best$CP, best$BIC))
```


```{r}
#WLS model
wm <- lm(price ~ livingArea + yearBuilt + numDwellings + combined  + mf + r10  + mf:livingArea, data = both, weights = m.weights)
summary(wm)
ols_test_normality(wm)
pr <- resid(wm)/(1 - lm.influence(wm)$hat)
sum(pr ^ 2)
round(wm$coefficients, 5)
```


```{r}
wm2 <- lm(price ~ livingArea + combined + mf + r10  + mf:livingArea, data = both, weights = m.weights)
summary(wm2)
```

```{r}
wm3 <- lm(price ~ livingArea + yearBuilt + numDwellings + r7 + Freq + combined  + mf + r10  + mf:livingArea + rating, data = both, weights = m.weights)
```



```{r}
plot(wm)
```

```{r}
yhat <- mean(both$price)
sum((predict(wm) - yhat)^2)
sum(wm$residuals^2)
```

```{r}
plot(wm$fitted.values , stdres(wm), main="Fitted vs R-Student for Regressor Transformation", xlab = "Fitted Values", ylab = "R-Student")
abline(0, 0, col= "red")
```

```{r}
qqnorm(stdres(wm))
qqline(stdres(wm), col= "red")
```

```{r}
data.price <- both[c("price", "livingArea", "combined", "usSA", "seasonal", "parcelRes", "r10", "a2", "mf")]
data <- both[c("livingArea", "yearBuilt", "combined", "numDwellings","r10","mf")]
```

```{r}
vif(wm)
```

```{r}
plot(both$dateSold, rstudent(wm), main="Date Sold vs R-Student", xlab="Date Sold (Days since 4/1/2018)", ylab="R-Student", ylim=c(-3,3))
abline(0, 0, col= "red")
```

```{r}
plot(wm$fitted.values, studres(wm))
```

```{r}
medians <- apply(both, 2, median)
both$mad <- medians
```

```{r}
n <- nrow(both)
p <- 9
covratio_filter <- abs(covratio(wm)) < 1 - (3*p/n)
covratio_filter2 <- abs(covratio(wm)) > 1 + (3*p/n)
wm.covr <- abs(covratio(wm))
wm.covr[covratio_filter]
wm.covr[covratio_filter2]
```

```{r}
wm.cooks <- cooks.distance(wm)
cookf <- pf(0.20, p, n-p)
wm.cooks[wm.cooks >  cookf]
```

```{r}
dfb <- abs(dfbetas(wm))
(2/sqrt(n))
round(dfb,2)
plot(wm)
```

```{r}
vif(wm, data=both)
X <- as.matrix(both[c("livingArea", "yearBuilt","combined", "numDwellings", "r10", "mf", "mfArea")])
XtX <- t(X) %*% X
eigen(XtX)$values
cond.index(wm, data=both)
```

```{r}
p <- 7
n <- nrow(both)
constm <- lm(price ~ 1, data = both)
yhat <- mean(both$price)
SSres <- sum(wm$residuals^2)
MSres <- SSres / (n - p)
SSt <- sum((both$price - yhat)^2)
SSreg <- sum((wm$fitted.values - yhat)^2)
MSreg <- SSreg / p
SSreg
SSres
SSreg + SSres
MSreg
MSres
MSreg/MSres
```

```{r}
summary(wm)
anova(wm)
```

```{r}
test <- read.csv("homes_for_model_val2.csv")
test$numDwellings <- log(test$numDwellings)


predictions1 <- predict(wm, test)
predictions2 <- predict(wm2, test)
predictions3 <- predict(wm3, test)

data.frame(R2 = R2(predictions1, test$price),
            RMSE = RMSE(predictions1, test$price),
            MAE = MAE(predictions1, test$price))

wm1.i <- RMSE(predictions1, test$price)/mean(test$price)

data.frame(R2 = R2(predictions2, test$price),
            RMSE = RMSE(predictions2, test$price),
            MAE = MAE(predictions2, test$price))

wm2.i <- RMSE(predictions2, test$price)/mean(test$price)

data.frame(R2 = R2(predictions3, test$price),
            RMSE = RMSE(predictions3, test$price),
            MAE = MAE(predictions3, test$price))

wm3.i <- RMSE(predictions3, test$price)/mean(test$price)
```

```{r}
test <- read.csv("homes_for_model_val_extrap2.csv")
test$numDwellings <- log(test$numDwellings)


predictions1 <- predict(wm, test)
predictions2 <- predict(wm2, test)
predictions3 <- predict(wm3, test)

data.frame(R2 = R2(predictions1, test$price),
            RMSE = RMSE(predictions1, test$price),
            MAE = MAE(predictions1, test$price))

wm1.e <- RMSE(predictions1, test$price)/mean(test$price)


data.frame(R2 = R2(predictions2, test$price),
            RMSE = RMSE(predictions2, test$price),
            MAE = MAE(predictions2, test$price))

wm2.e <- RMSE(predictions2, test$price)/mean(test$price)


data.frame(R2 = R2(predictions3, test$price),
            RMSE = RMSE(predictions3, test$price),
            MAE = MAE(predictions3, test$price))

wm3.e <- RMSE(predictions3, test$price)/mean(test$price)
```
```{r}
wm1.i + wm1.e
wm2.i + wm2.e
wm3.i + wm3.e
```



```{r}
closeAllConnections() 
```


Call:
lm(formula = price ~ ., data = both)

Residuals:
    Min      1Q  Median      3Q     Max 
-334244  -81055   -1481   80112  421663 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)  -3.369e+06  3.047e+06  -1.106 0.270173    
dateSold     -2.989e+02  3.035e+02  -0.985 0.325905    
livingArea    3.103e+02  1.953e+01  15.885  < 2e-16 ***
bedrooms      1.001e+04  1.373e+04   0.729 0.466923    
bathrooms    -5.462e+03  1.858e+04  -0.294 0.769015    
yearBuilt     7.564e+02  5.768e+02   1.311 0.191280    
elevation    -1.603e+02  3.124e+02  -0.513 0.608472    
numPhoto      2.891e+02  1.362e+03   0.212 0.832044    
combined      4.092e+03  1.741e+03   2.350 0.019747 *  
r5           -4.572e+04  1.115e+05  -0.410 0.682224    
r7           -2.319e+04  9.755e+04  -0.238 0.812362    
r10           6.305e+04  9.304e+04   0.678 0.498747    
parcel       -2.731e-02  7.123e-02  -0.383 0.701797    
mf           -4.232e+05  8.331e+04  -5.080 8.65e-07 ***
mfArea        1.891e+02  4.814e+01   3.928 0.000118 ***
a1           -3.610e+04  1.501e+05  -0.241 0.810190    
a2           -9.151e+04  1.296e+05  -0.706 0.481042    
a3           -4.652e+04  1.537e+05  -0.303 0.762445    
numDwellings -1.729e+04  2.517e+04  -0.687 0.492892    
rating       -9.929e+03  1.370e+04  -0.725 0.469530    
Freq          3.081e+03  3.572e+03   0.863 0.389395    
seasonal      2.647e+04  1.825e+04   1.450 0.148569    
pacSA        -1.316e+04  2.104e+04  -0.625 0.532524    
usSA          2.144e+04  2.926e+04   0.733 0.464556    
hiSA          2.944e+03  9.112e+03   0.323 0.746931    
parcelRes     7.710e-02  8.111e-02   0.951 0.342944    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 149900 on 199 degrees of freedom
Multiple R-squared:  0.9326,	Adjusted R-squared:  0.9242 
F-statistic: 110.2 on 25 and 199 DF,  p-value: < 2.2e-16

-----------------------------------------------
       Test             Statistic       pvalue  
-----------------------------------------------
Shapiro-Wilk              0.9832         0.0090 
Kolmogorov-Smirnov        0.0541         0.5256 
Cramer-von Mises         18.8044         0.0000 
Anderson-Darling          1.0892         0.0073 
-----------------------------------------------
[1] 6.727216e+12
[[1]]
  (Intercept)    livingArea     yearBuilt      combined           r10            mf  numDwellings        rating 
-1.015021e+06  3.145409e+02  6.006176e+02  4.783558e+03  7.828822e+04 -4.616739e+05 -2.563803e+04 -1.594402e+04 
     seasonal         pacSA     parcelRes livingArea:mf 
 2.088451e+04  7.597514e+02  4.790387e-02  2.059265e+02 

[[2]]
  (Intercept)    livingArea      combined           r10            mf  numDwellings     parcelRes livingArea:mf 
 3.509516e+05  3.178970e+02  3.510268e+03  7.484687e+04 -4.262177e+05 -2.876012e+04  6.109312e-02  1.921775e+02 

[[3]]
  (Intercept)    livingArea      combined           r10            mf livingArea:mf 
  260753.7028      325.2969     4194.5461    95063.3782  -492396.5604      208.6279 


Call:
lm(formula = price ~ livingArea + yearBuilt + numDwellings + 
    seasonal + pacSA + parcelRes + combined + mf + r10 + mf:livingArea, 
    data = both)

Residuals:
    Min      1Q  Median      3Q     Max 
-345179  -81535   -1951   71447  455815 

Coefficients:
                Estimate Std. Error t value Pr(>|t|)    
(Intercept)   -1.024e+06  1.039e+06  -0.985   0.3256    
livingArea     3.150e+02  1.323e+01  23.815  < 2e-16 ***
yearBuilt      5.880e+02  5.217e+02   1.127   0.2609    
numDwellings  -3.251e+04  1.644e+04  -1.977   0.0493 *  
seasonal       2.091e+04  1.479e+04   1.414   0.1589    
pacSA          7.221e+02  5.068e+02   1.425   0.1556    
parcelRes      5.176e-02  4.075e-02   1.270   0.2054    
combined       3.581e+03  1.082e+03   3.309   0.0011 ** 
mf            -4.404e+05  6.564e+04  -6.709 1.72e-10 ***
r10            7.026e+04  3.282e+04   2.141   0.0334 *  
livingArea:mf  1.959e+02  3.994e+01   4.904 1.85e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 146300 on 214 degrees of freedom
Multiple R-squared:  0.931,	Adjusted R-squared:  0.9278 
F-statistic: 288.9 on 10 and 214 DF,  p-value: < 2.2e-16

-----------------------------------------------
       Test             Statistic       pvalue  
-----------------------------------------------
Shapiro-Wilk              0.9808         0.0037 
Kolmogorov-Smirnov        0.0668         0.2682 
Cramer-von Mises         18.7511         0.0000 
Anderson-Darling          1.3539         0.0016 
-----------------------------------------------
[1] 0.9904253
  (Intercept)    livingArea     yearBuilt  numDwellings      seasonal         pacSA     parcelRes      combined 
-1.024053e+06  3.149648e+02  5.880034e+02 -3.250501e+04  2.090890e+04  7.221407e+02  5.176000e-02  3.581472e+03 
           mf           r10 livingArea:mf 
-4.404171e+05  7.026023e+04  1.958691e+02 
[1] 5.163587e+12

Call:
lm(formula = price ~ livingArea + yearBuilt + numDwellings + 
    seasonal + pacSA + parcelRes + combined + mf + r10 + mf:livingArea, 
    data = both)

Residuals:
    Min      1Q  Median      3Q     Max 
-345179  -81535   -1951   71447  455815 

Coefficients:
                Estimate Std. Error t value Pr(>|t|)    
(Intercept)   -1.024e+06  1.039e+06  -0.985   0.3256    
livingArea     3.150e+02  1.323e+01  23.815  < 2e-16 ***
yearBuilt      5.880e+02  5.217e+02   1.127   0.2609    
numDwellings  -3.251e+04  1.644e+04  -1.977   0.0493 *  
seasonal       2.091e+04  1.479e+04   1.414   0.1589    
pacSA          7.221e+02  5.068e+02   1.425   0.1556    
parcelRes      5.176e-02  4.075e-02   1.270   0.2054    
combined       3.581e+03  1.082e+03   3.309   0.0011 ** 
mf            -4.404e+05  6.564e+04  -6.709 1.72e-10 ***
r10            7.026e+04  3.282e+04   2.141   0.0334 *  
livingArea:mf  1.959e+02  3.994e+01   4.904 1.85e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 146300 on 214 degrees of freedom
Multiple R-squared:  0.931,	Adjusted R-squared:  0.9278 
F-statistic: 288.9 on 10 and 214 DF,  p-value: < 2.2e-16

[[1]]
  (Intercept)    livingArea     yearBuilt      combined           r10            mf        mfArea            a2 
-2272921.9316      316.1427     1326.3308     5309.8227    77935.0195  -442177.5999      180.2512   -31188.4606 
 numDwellings        rating          Freq 
  -12976.8710   -14796.2596     2687.7091 

[[2]]
  (Intercept)    livingArea     yearBuilt      combined           r10            mf        mfArea  numDwellings 
-2239744.8180      316.5901     1321.1042     5478.0475    77186.4558  -470385.9689      191.6081   -14730.2852 
       rating 
  -16370.4572 

[[3]]
  (Intercept)    livingArea     yearBuilt      combined           r10            mf        rating livingArea:mf 
-2081286.4425      317.3638     1228.1334     6081.3039    92776.5132  -503104.2163   -20673.8862      197.8129 


Call:
lm(formula = price ~ livingArea + yearBuilt + numDwellings + 
    combined + mf + r10 + mf:livingArea, data = both, weights = m.weights)

Weighted Residuals:
    Min      1Q  Median      3Q     Max 
-2.8830 -0.7940  0.0302  0.7976  4.1205 

Coefficients:
                Estimate Std. Error t value Pr(>|t|)    
(Intercept)   -2.205e+06  8.959e+05  -2.461  0.01462 *  
livingArea     3.201e+02  1.657e+01  19.316  < 2e-16 ***
yearBuilt      1.319e+03  4.582e+02   2.880  0.00438 ** 
numDwellings  -2.288e+04  8.266e+03  -2.768  0.00613 ** 
combined       3.111e+03  6.850e+02   4.542 9.24e-06 ***
mf            -4.628e+05  4.485e+04 -10.319  < 2e-16 ***
r10            6.838e+04  3.269e+04   2.092  0.03763 *  
livingArea:mf  1.866e+02  3.080e+01   6.058 6.01e-09 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 1.239 on 217 degrees of freedom
Multiple R-squared:  0.9514,	Adjusted R-squared:  0.9498 
F-statistic: 606.8 on 7 and 217 DF,  p-value: < 2.2e-16

-----------------------------------------------
       Test             Statistic       pvalue  
-----------------------------------------------
Shapiro-Wilk              0.9751          5e-04 
Kolmogorov-Smirnov        0.0779         0.1299 
Cramer-von Mises         18.7778         0.0000 
Anderson-Darling          2.0707         0.0000 
-----------------------------------------------
[1] 5.032047e+12
  (Intercept)    livingArea     yearBuilt  numDwellings      combined            mf           r10 livingArea:mf 
-2205171.8909      320.0977     1319.4659   -22880.4670     3111.1223  -462760.0253    68377.1584      186.6106 

Call:
lm(formula = price ~ livingArea + combined + mf + r10 + mf:livingArea, 
    data = both, weights = m.weights)

Weighted Residuals:
    Min      1Q  Median      3Q     Max 
-3.1434 -0.7956  0.0012  0.8581  4.0963 

Coefficients:
                Estimate Std. Error t value Pr(>|t|)    
(Intercept)    346165.76   58523.86   5.915 1.26e-08 ***
livingArea        329.43      16.79  19.617  < 2e-16 ***
combined         2902.09     699.90   4.146 4.83e-05 ***
mf            -497708.40   40262.78 -12.362  < 2e-16 ***
r10             97820.49   32291.64   3.029  0.00275 ** 
livingArea:mf     198.69      31.44   6.319 1.45e-09 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 1.273 on 219 degrees of freedom
Multiple R-squared:  0.9482,	Adjusted R-squared:  0.9471 
F-statistic: 802.4 on 5 and 219 DF,  p-value: < 2.2e-16

[1] 6.169613e+13
[1] 4.740175e+12
   livingArea     yearBuilt  numDwellings      combined            mf           r10 livingArea:mf 
     3.409233      1.287478      3.401231      1.610104      9.482406      1.341366      3.396121 
Error in `$<-.data.frame`(`*tmp*`, mad, value = c(price = 1020000, dateSold = 554,  : 
  replacement has 26 rows, data has 225
       17        53        69       111       118 
0.8675198 0.8743513 0.8186565 0.8722864 0.7038863 
      52      137      153      155      178      179      207      225 
1.138601 1.123164 1.127552 1.147051 1.147769 1.134442 1.133402 1.149992 
          1           3           4          17          27          35          38          41          42 
0.013302145 0.006053206 0.029505347 0.009058825 0.006245240 0.024204689 0.013358274 0.010224181 0.006244758 
         43          46          53          56          63          67          69          70          71 
0.016014504 0.007115748 0.010128860 0.010282461 0.021701268 0.008043184 0.034754035 0.010958606 0.009246541 
         75          79          80          88          97         101         104         106         111 
0.006846421 0.011652431 0.026000451 0.007086164 0.009412544 0.011749712 0.026815739 0.007096052 0.025713440 
        112         117         118         119         125         126         127         128         138 
0.007659372 0.016623991 0.081390095 0.007473626 0.016508533 0.007432141 0.008403616 0.008771410 0.007429300 
        147         149         151         152         156         158         159         167         168 
0.019080426 0.012577951 0.013236286 0.006804137 0.013972011 0.007355659 0.006134655 0.011258839 0.007615362 
        174         184         187         192         193         196         199         203         215 
0.007633391 0.006230999 0.013799385 0.013424080 0.007658091 0.006666692 0.009637802 0.011256464 0.006580541 
        221 
0.009989103 
[1] 0.1333333
    (Intercept) livingArea yearBuilt numDwellings combined   mf  r10 livingArea:mf
1          0.03       0.08      0.03         0.01     0.10 0.02 0.25          0.02
2          0.00       0.00      0.00         0.01     0.01 0.00 0.02          0.00
3          0.08       0.07      0.08         0.04     0.04 0.01 0.11          0.06
4          0.13       0.01      0.13         0.29     0.15 0.30 0.07          0.16
5          0.04       0.05      0.04         0.01     0.05 0.04 0.03          0.02
6          0.07       0.16      0.08         0.00     0.04 0.10 0.07          0.09
7          0.00       0.00      0.00         0.00     0.00 0.00 0.00          0.00
8          0.02       0.01      0.01         0.11     0.13 0.04 0.02          0.01
9          0.00       0.00      0.00         0.03     0.02 0.03 0.01          0.01
10         0.00       0.00      0.00         0.00     0.01 0.00 0.01          0.00
11         0.05       0.02      0.05         0.08     0.06 0.08 0.02          0.07
12         0.00       0.01      0.00         0.00     0.00 0.01 0.07          0.01
13         0.04       0.02      0.04         0.04     0.09 0.00 0.09          0.03
14         0.03       0.04      0.03         0.02     0.02 0.04 0.04          0.01
15         0.03       0.02      0.03         0.01     0.01 0.01 0.03          0.02
16         0.00       0.01      0.00         0.00     0.00 0.01 0.00          0.00
17         0.01       0.05      0.01         0.05     0.14 0.04 0.11          0.00
18         0.01       0.01      0.00         0.02     0.06 0.04 0.06          0.00
19         0.02       0.01      0.02         0.01     0.00 0.00 0.01          0.01
20         0.02       0.01      0.02         0.11     0.07 0.13 0.03          0.09
21         0.13       0.09      0.13         0.05     0.05 0.08 0.07          0.02
22         0.00       0.15      0.00         0.00     0.00 0.08 0.05          0.08
23         0.01       0.01      0.01         0.02     0.03 0.02 0.01          0.03
24         0.01       0.00      0.01         0.07     0.00 0.06 0.02          0.08
25         0.01       0.02      0.01         0.01     0.01 0.00 0.03          0.01
26         0.00       0.01      0.00         0.00     0.00 0.00 0.00          0.00
27         0.03       0.14      0.03         0.01     0.01 0.09 0.13          0.07
28         0.00       0.00      0.01         0.08     0.06 0.04 0.02          0.01
29         0.04       0.01      0.04         0.01     0.00 0.02 0.01          0.05
30         0.00       0.01      0.00         0.01     0.09 0.01 0.00          0.01
31         0.10       0.03      0.10         0.01     0.07 0.02 0.05          0.01
32         0.02       0.01      0.02         0.00     0.04 0.04 0.01          0.01
33         0.01       0.00      0.01         0.02     0.05 0.00 0.05          0.01
34         0.02       0.01      0.02         0.00     0.06 0.01 0.00          0.01
35         0.05       0.03      0.03         0.12     0.26 0.07 0.02          0.24
36         0.01       0.01      0.01         0.00     0.01 0.01 0.08          0.01
37         0.05       0.07      0.05         0.01     0.01 0.03 0.04          0.04
38         0.27       0.02      0.27         0.00     0.11 0.03 0.10          0.06
39         0.03       0.00      0.03         0.01     0.05 0.02 0.00          0.05
40         0.00       0.01      0.00         0.00     0.00 0.01 0.01          0.01
41         0.01       0.01      0.02         0.17     0.14 0.10 0.04          0.08
42         0.02       0.19      0.02         0.01     0.01 0.13 0.08          0.10
43         0.24       0.10      0.24         0.16     0.13 0.09 0.04          0.01
44         0.01       0.03      0.01         0.01     0.02 0.02 0.02          0.01
45         0.02       0.01      0.01         0.03     0.03 0.04 0.01          0.04
46         0.01       0.20      0.00         0.01     0.01 0.13 0.08          0.10
47         0.04       0.10      0.04         0.00     0.00 0.06 0.05          0.06
48         0.01       0.07      0.01         0.00     0.02 0.04 0.13          0.04
49         0.05       0.01      0.05         0.00     0.00 0.06 0.00          0.11
50         0.03       0.13      0.03         0.01     0.00 0.07 0.05          0.07
51         0.00       0.00      0.00         0.00     0.00 0.00 0.00          0.00
52         0.02       0.00      0.02         0.01     0.01 0.01 0.00          0.05
53         0.17       0.03      0.17         0.07     0.06 0.06 0.13          0.02
54         0.00       0.00      0.00         0.01     0.00 0.00 0.00          0.00
55         0.12       0.03      0.13         0.04     0.06 0.01 0.04          0.01
56         0.09       0.25      0.08         0.01     0.01 0.14 0.08          0.14
57         0.02       0.02      0.02         0.02     0.04 0.01 0.04          0.00
58         0.01       0.02      0.01         0.01     0.01 0.02 0.02          0.01
59         0.02       0.07      0.02         0.03     0.06 0.02 0.05          0.02
60         0.04       0.00      0.04         0.02     0.00 0.07 0.00          0.13
61         0.03       0.01      0.03         0.07     0.05 0.09 0.02          0.07
62         0.07       0.02      0.06         0.02     0.13 0.09 0.02          0.04
63         0.12       0.06      0.11         0.10     0.35 0.07 0.04          0.08
64         0.00       0.02      0.00         0.00     0.01 0.01 0.01          0.01
65         0.01       0.01      0.01         0.01     0.01 0.02 0.01          0.01
66         0.02       0.01      0.02         0.00     0.01 0.01 0.04          0.01
67         0.10       0.12      0.11         0.02     0.03 0.09 0.16          0.06
68         0.06       0.03      0.06         0.01     0.01 0.02 0.05          0.01
69         0.31       0.03      0.32         0.22     0.08 0.18 0.04          0.10
70         0.15       0.03      0.14         0.12     0.16 0.09 0.02          0.02
71         0.14       0.05      0.14         0.02     0.08 0.02 0.18          0.00
72         0.06       0.08      0.05         0.00     0.00 0.05 0.06          0.05
73         0.03       0.10      0.03         0.03     0.03 0.03 0.10          0.06
74         0.03       0.04      0.03         0.00     0.01 0.03 0.01          0.02
75         0.10       0.10      0.10         0.04     0.09 0.09 0.04          0.05
76         0.00       0.13      0.01         0.00     0.00 0.07 0.04          0.07
77         0.11       0.02      0.11         0.00     0.06 0.01 0.01          0.03
78         0.03       0.00      0.03         0.05     0.07 0.02 0.01          0.01
79         0.20       0.10      0.21         0.12     0.03 0.21 0.03          0.05
80         0.14       0.11      0.13         0.01     0.12 0.10 0.37          0.09
81         0.06       0.01      0.06         0.00     0.02 0.00 0.02          0.00
82         0.02       0.04      0.02         0.01     0.02 0.03 0.02          0.01
83         0.00       0.00      0.00         0.00     0.01 0.00 0.01          0.00
84         0.07       0.15      0.07         0.02     0.00 0.10 0.07          0.07
85         0.02       0.03      0.02         0.00     0.01 0.02 0.01          0.01
86         0.05       0.02      0.05         0.01     0.05 0.00 0.14          0.01
87         0.01       0.00      0.01         0.01     0.01 0.01 0.02          0.01
88         0.05       0.00      0.06         0.13     0.11 0.08 0.04          0.08
89         0.01       0.01      0.01         0.01     0.01 0.00 0.02          0.01
90         0.01       0.07      0.01         0.01     0.01 0.03 0.05          0.04
91         0.01       0.00      0.01         0.00     0.01 0.01 0.00          0.00
92         0.00       0.01      0.00         0.00     0.00 0.00 0.00          0.00
93         0.02       0.01      0.02         0.01     0.00 0.01 0.01          0.00
94         0.01       0.04      0.01         0.00     0.01 0.03 0.03          0.02
95         0.01       0.02      0.01         0.00     0.01 0.01 0.10          0.01
96         0.00       0.03      0.00         0.00     0.01 0.01 0.05          0.01
97         0.00       0.23      0.00         0.02     0.01 0.12 0.10          0.13
98         0.01       0.02      0.01         0.00     0.03 0.02 0.09          0.02
99         0.01       0.01      0.01         0.01     0.01 0.00 0.02          0.01
100        0.00       0.01      0.00         0.01     0.01 0.00 0.02          0.00
101        0.19       0.15      0.19         0.07     0.07 0.05 0.07          0.06
102        0.06       0.00      0.07         0.01     0.06 0.07 0.01          0.08
103        0.01       0.01      0.01         0.00     0.00 0.01 0.00          0.00
104        0.13       0.02      0.14         0.17     0.25 0.08 0.04          0.06
105        0.04       0.04      0.04         0.01     0.02 0.01 0.01          0.01
106        0.03       0.00      0.03         0.06     0.01 0.11 0.01          0.19
107        0.00       0.00      0.00         0.00     0.00 0.00 0.01          0.00
108        0.00       0.01      0.00         0.00     0.02 0.01 0.06          0.01
109        0.03       0.01      0.03         0.01     0.02 0.02 0.01          0.01
110        0.00       0.02      0.01         0.01     0.04 0.06 0.03          0.02
111        0.16       0.23      0.14         0.07     0.14 0.32 0.07          0.17
112        0.14       0.04      0.13         0.05     0.12 0.03 0.10          0.02
113        0.02       0.00      0.02         0.01     0.02 0.02 0.01          0.01
114        0.00       0.00      0.00         0.00     0.00 0.00 0.00          0.00
115        0.07       0.04      0.07         0.03     0.03 0.05 0.06          0.01
116        0.02       0.06      0.03         0.01     0.00 0.04 0.08          0.03
117        0.01       0.29      0.02         0.02     0.10 0.16 0.14          0.14
118        0.01       0.23      0.04         0.07     0.61 0.53 0.13          0.22
119        0.09       0.00      0.10         0.10     0.08 0.15 0.02          0.10
120        0.00       0.01      0.01         0.07     0.06 0.06 0.00          0.01
121        0.02       0.04      0.01         0.00     0.01 0.02 0.07          0.02
122        0.01       0.02      0.02         0.02     0.07 0.04 0.05          0.00
123        0.00       0.01      0.00         0.00     0.00 0.01 0.01          0.00
124        0.03       0.04      0.03         0.01     0.00 0.03 0.07          0.02
125        0.03       0.11      0.05         0.12     0.24 0.27 0.03          0.11
 [ reached getOption("max.print") -- omitted 100 rows ]
   livingArea     yearBuilt  numDwellings      combined            mf           r10 livingArea:mf 
     3.409233      1.287478      3.401231      1.610104      9.482406      1.341366      3.396121 
[1] 1.696141e+09 1.592195e+08 4.176225e+07 2.470418e+04 1.851565e+02 2.305112e+01 4.838396e+00
[1]   1.000000   1.736936   3.025796   4.405577   7.726799  11.908619  22.831227 331.827904
[1] 6.169613e+13
[1] 4.740175e+12
[1] 6.64363e+13
[1] 8.813733e+12
[1] 21743923993
[1] 405.3423

Call:
lm(formula = price ~ livingArea + yearBuilt + numDwellings + 
    combined + mf + r10 + mf:livingArea, data = both, weights = m.weights)

Weighted Residuals:
    Min      1Q  Median      3Q     Max 
-2.8830 -0.7940  0.0302  0.7976  4.1205 

Coefficients:
                Estimate Std. Error t value Pr(>|t|)    
(Intercept)   -2.205e+06  8.959e+05  -2.461  0.01462 *  
livingArea     3.201e+02  1.657e+01  19.316  < 2e-16 ***
yearBuilt      1.319e+03  4.582e+02   2.880  0.00438 ** 
numDwellings  -2.288e+04  8.266e+03  -2.768  0.00613 ** 
combined       3.111e+03  6.850e+02   4.542 9.24e-06 ***
mf            -4.628e+05  4.485e+04 -10.319  < 2e-16 ***
r10            6.838e+04  3.269e+04   2.092  0.03763 *  
livingArea:mf  1.866e+02  3.080e+01   6.058 6.01e-09 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 1.239 on 217 degrees of freedom
Multiple R-squared:  0.9514,	Adjusted R-squared:  0.9498 
F-statistic: 606.8 on 7 and 217 DF,  p-value: < 2.2e-16

Analysis of Variance Table

Response: price
               Df Sum Sq Mean Sq   F value    Pr(>F)    
livingArea      1 6015.6  6015.6 3917.5607 < 2.2e-16 ***
yearBuilt       1   25.6    25.6   16.6622 6.279e-05 ***
numDwellings    1  225.4   225.4  146.8203 < 2.2e-16 ***
combined        1   80.6    80.6   52.5076 7.404e-12 ***
mf              1  115.2   115.2   75.0226 1.074e-15 ***
r10             1    3.3     3.3    2.1284     0.146    
livingArea:mf   1   56.4    56.4   36.6995 6.015e-09 ***
Residuals     217  333.2     1.5                        
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
[1] 0.4845678
[1] 0.4732155
[1] 0.4738142
